# ארכיטקטורת מערכת מוצרים - תכנון מפורט

## מבנה היררכי

```
תחום (Category)
└── מוצר (Product)
    ├── גדלים (Sizes) - רשימה סגורה
    ├── כמויות (Quantities) - רשימה סגורה + "אחר"
    ├── תוספות (Addons) - אופציונלי
    └── תמונה (Image)
```

## טבלאות בדאטאבייס

### 1. categories (קיים)
| עמודה | סוג | תיאור |
|-------|-----|-------|
| id | SERIAL | מזהה ראשי |
| name | VARCHAR | שם התחום |
| description | TEXT | תיאור |
| icon | VARCHAR | אייקון |
| displayOrder | INT | סדר תצוגה |

### 2. base_products (עדכון)
| עמודה | סוג | תיאור |
|-------|-----|-------|
| id | SERIAL | מזהה ראשי |
| name | VARCHAR | שם המוצר |
| description | TEXT | תיאור |
| categoryId | INT | קישור לתחום |
| imageUrl | TEXT | תמונת המוצר |
| allowCustomQuantity | BOOLEAN | האם לאפשר כמות מותאמת |
| isActive | BOOLEAN | פעיל |

### 3. product_sizes (חדש)
| עמודה | סוג | תיאור |
|-------|-----|-------|
| id | SERIAL | מזהה ראשי |
| productId | INT | קישור למוצר |
| name | VARCHAR | שם הגודל (9x5 ס"מ) |
| dimensions | VARCHAR | מידות טכניות |
| basePrice | DECIMAL | מחיר בסיס |
| displayOrder | INT | סדר תצוגה |
| isActive | BOOLEAN | פעיל |

### 4. product_quantities (חדש)
| עמודה | סוג | תיאור |
|-------|-----|-------|
| id | SERIAL | מזהה ראשי |
| productId | INT | קישור למוצר |
| quantity | INT | כמות (100, 250, 500...) |
| priceMultiplier | DECIMAL | מכפיל מחיר (1.0, 1.8, 3.2...) |
| displayOrder | INT | סדר תצוגה |
| isActive | BOOLEAN | פעיל |

### 5. product_addons (חדש)
| עמודה | סוג | תיאור |
|-------|-----|-------|
| id | SERIAL | מזהה ראשי |
| productId | INT | קישור למוצר (NULL = גלובלי) |
| categoryId | INT | קישור לתחום (NULL = כל התחומים) |
| name | VARCHAR | שם התוספת (למינציה) |
| description | TEXT | תיאור |
| priceType | VARCHAR | 'fixed' / 'percentage' / 'per_unit' |
| price | DECIMAL | מחיר/אחוז |
| isActive | BOOLEAN | פעיל |

## חישוב מחיר

```
מחיר סופי = (מחיר_בסיס_גודל × מכפיל_כמות) + סכום_תוספות
```

### דוגמה - כרטיסי ביקור:
- גודל 9x5 ס"מ: מחיר בסיס ₪50
- כמות 250: מכפיל 1.8
- למינציה: +₪30 קבוע
- פינות מעוגלות: +10%

```
מחיר = (50 × 1.8) + 30 + (90 × 0.10) = 90 + 30 + 9 = ₪129
```

## זרימת עבודה - לקוח

1. בוחר תחום (בית דפוס)
2. בוחר מוצר (כרטיסי ביקור)
3. בוחר גודל מרשימה (9x5 ס"מ)
4. בוחר כמות מרשימה (250) **או** "כמות אחרת" + הזנה ידנית
5. בוחר תוספות (צ'קבוקסים)
6. רואה מחיר מחושב (או "יתומחר ידנית" אם כמות מותאמת)
7. שולח בקשה

## זרימת עבודה - מנהל

### ניהול מוצר:
1. בוחר תחום
2. יוצר/עורך מוצר
3. מגדיר גדלים + מחירי בסיס
4. מגדיר כמויות + מכפילים
5. מגדיר תוספות זמינות
6. מעלה תמונה

### טיפול בבקשה עם כמות מותאמת:
1. מקבל התראה על בקשה חדשה
2. רואה את הכמות המבוקשת
3. מזין מחיר ידני
4. שולח הצעה ללקוח

## API Endpoints

### Products
- `GET /products.list` - רשימת מוצרים עם גדלים, כמויות ותוספות
- `GET /products.getById` - מוצר בודד עם כל הפרטים
- `POST /products.create` - יצירת מוצר
- `PUT /products.update` - עדכון מוצר
- `DELETE /products.delete` - מחיקת מוצר

### Sizes
- `POST /products.createSize` - הוספת גודל
- `PUT /products.updateSize` - עדכון גודל
- `DELETE /products.deleteSize` - מחיקת גודל

### Quantities
- `POST /products.createQuantity` - הוספת כמות
- `PUT /products.updateQuantity` - עדכון כמות
- `DELETE /products.deleteQuantity` - מחיקת כמות

### Addons
- `POST /products.createAddon` - הוספת תוספת
- `PUT /products.updateAddon` - עדכון תוספת
- `DELETE /products.deleteAddon` - מחיקת תוספת

### Price Calculation
- `POST /products.calculatePrice` - חישוב מחיר לפי בחירות

## UI Components

### עמוד ניהול מוצרים:
```
┌─────────────────────────────────────────────────┐
│ [בית דפוס] [פורמט רחב] [שלטים] [משי] [סובלימציה] │
├─────────────────────────────────────────────────┤
│ 📦 כרטיסי ביקור                    [עריכה] [🗑️] │
│    ├── גדלים: 9x5, 8.5x5.5, מותאם אישית        │
│    ├── כמויות: 100, 250, 500, 1000             │
│    └── תוספות: למינציה, פינות מעוגלות, הבלטה   │
└─────────────────────────────────────────────────┘
```

### טופס הצעת מחיר ללקוח:
```
┌─────────────────────────────────────────────────┐
│ בחר מוצר: [כרטיסי ביקור ▼]                      │
│                                                 │
│ גודל: ○ 9x5 ס"מ  ○ 8.5x5.5 ס"מ  ○ מותאם אישית │
│                                                 │
│ כמות: ○ 100  ○ 250  ○ 500  ○ 1000  ○ אחר [___] │
│                                                 │
│ תוספות:                                         │
│ ☐ למינציה (+₪30)                               │
│ ☐ פינות מעוגלות (+₪20)                         │
│ ☐ הבלטה (+₪80)                                 │
│                                                 │
│ ─────────────────────────────────────────────── │
│ מחיר משוער: ₪129                               │
│ [שלח בקשה להצעת מחיר]                          │
└─────────────────────────────────────────────────┘
```
